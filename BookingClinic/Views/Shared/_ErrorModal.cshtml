@using BookingClinic.Application.Common
@{
    var errors = ViewData["Errors"];
    ServiceError? error = null;

    if (errors != null)
    {
        error = ((IEnumerable<ServiceError>)errors).FirstOrDefault();
    }
}

<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content border-danger">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="errorModalLabel">@error?.Code.ToString()</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div>@error?.Message</div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@if (error != null)
{
    <script>
        (function () {
            function showErrorModal() {
                var modalEl = document.getElementById('errorModal');
                if (!modalEl) return;

                // Bootstrap 5 (native)
                if (window.bootstrap && typeof window.bootstrap.Modal === 'function') {
                    try {
                        var m = new bootstrap.Modal(modalEl);
                        m.show();
                        return;
                    } catch (e) {
                        console.error('Error showing bootstrap modal (BS5):', e);
                    }
                }

                // Fallback для Bootstrap 4 (jQuery)
                if (window.jQuery && typeof jQuery === 'function' && typeof jQuery(modalEl).modal === 'function') {
                    try {
                        jQuery(modalEl).modal('show');
                        return;
                    } catch (e) {
                        console.error('Error showing bootstrap modal (BS4/jQuery):', e);
                    }
                }

                console.warn('Error modal: Bootstrap JS not found or unsupported version.');
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', showErrorModal);
            } else {
                showErrorModal();
            }
        })();
    </script>
}